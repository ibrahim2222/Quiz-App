@model List<Question>
@{
    ViewData["Title"] = "EditQuestions";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var MainQuestionCounter = 1;
    var VersionCounter = 0;
    var RadioCounter = 0;
}

<script src="https://code.jquery.com/jquery-3.6.4.min.js"></script>

<div class="page-body">
    <div class="container-fluid">
        <div class="page-title" style="margin-top: -29px !important;">
            <div class="row">
                <div class="col-6">
                    <h3>Form Wizard</h3>
                </div>
                <div class="col-6">
                </div>
            </div>
        </div>
    </div>
    <!-- Container-fluid starts-->
    <div class="container-fluid">
        <div class="row">
            <div class="col-md-12">
                <div class="card">
                    <div class="card-header d-flex justify-content-between align-items-center">
                        <h5 class="text-center">
                            <img width="60" class="me-2" height="60"
                                 src="https://img.icons8.com/external-vitaliy-gorbachev-lineal-color-vitaly-gorbachev/60/external-question-online-learning-vitaliy-gorbachev-lineal-color-vitaly-gorbachev.png" />
                            Question Edit
                        </h5>
                        <div class="form-buttons">
                            <button class=" btn btn-warning rounded-pill" id="submit" value="submit" type="submit">
                                <i class="fas fa-pencil-alt me-1 text-black" style="color: white !important; font-size: 15px;"></i>
                                Update
                            </button>
                            <button class="btn btn-warning addRow rounded-pill" type="button"><i class="fas fa-code-branch"></i> Add Version</button>
                            <a class=" btn btn-primary rounded-pill" id="submit" value="submit" type="submit" asp-action="CreateQuiz" asp-controller="Assesment" asp-route-id="@Model.First().QuizID">
                                <i class="fas fa-pencil-alt me-1 text-black" style="color: white !important; font-size: 15px;"></i>
                                Create Question
                            </a>
                        </div>
                    </div>
                    <div class="card-body">
                        <ul class="nav nav-tabs nav-secondary" id="question-tabs" role="tablist">
                            @{
                                var Tabcounter = 0;
                            }
                            @foreach (var mainQuestion in Model.Where(q => q.ID.ToString() == q.VersionID))
                            {
                                Tabcounter++;
                                <li class="nav-item" role="presentation">
                                    <a class="nav-link @(Tabcounter == 1 ? "active" : "")" id="question-tab-@mainQuestion.ID" data-bs-toggle="tab" href="#question-@mainQuestion.ID" role="tab" aria-controls="question-@mainQuestion.ID" aria-selected="false"><h5><i class="far fa-file-pdf"></i> Question @Tabcounter</h5></a>
                                </li>
                            }

                        </ul>

                        <div class="tab-content" id="question-tabs-content">
                               @if (Model.Any(q => q.ID.ToString() == q.VersionID))
                            {
                                @foreach (var mainQuestion in Model.Where(q => q.ID.ToString() == q.VersionID))
                                {

                                    <div class="tab-pane @(MainQuestionCounter == 1 ? "fade show active" : "fade")" id="question-@mainQuestion.ID" role="tabpanel" aria-labelledby="question-tab-@mainQuestion.ID">
                                        <div class="col-sm-12 col-xl-12 mt-5" style="top: -46px;">
                                            <div class="card card-absolute border border-secondary" style="margin-top:8%;">
                                                <div class="card-header bg-primary" style="top: -26px;">
                                                    <h5 class="text-white"> Main Question</h5>
                                                </div>

                                                <div class="card-body align-items-center justify-content-center tab">
                                                    <div class="widget-content">
                                                        <input type="hidden" name="quizId" value="@mainQuestion.ID" />
                                                        @mainQuestion.ID
                                                        <div class="row">
                                                            <div class="col-lg-12">
                                                                <div style="text-align: right !important;">
                                                                    @*<button class="btn btn-success ms-4 rounded-pill an" type="button" data-version="main"><i class="fas fa-plus-circle"></i> Add Answer</button>*@                                                                    
                                                                    <button class="btn btn-danger text-right rounded-pill removeMainQuestion" data-question-id="@mainQuestion.ID"><strong><i class="fas fa-trash-alt"></i></strong></button>
                                                                </div>
                                                            </div>
                                                            <script>
                                                                $(document).on("click", ".an", function () {
                                                                    if ($(this).data('handled')) {
                                                                        $(this).data('handled', false);
                                                                        return;
                                                                    }

                                                                    var questionId = '@mainQuestion.ID';
                                                                    var radioName = $(this).closest('.input-group').find('input[type="radio"]').attr('name');
                                                                    var newAns = $(
                                                                        "<div class='d-flex align-items-center justify-content-evenly py-2 input-group'>" +
                                                                        "<input type='radio' name='" + radioName + "' class='me-3 correct-answer'/>" +
                                                                        "<input type='text' class='form-control text-center text-black answer' placeholder='Answer' data-question-id='" + questionId + "'>" +
                                                                        "<input class='form-control ms-3 ImgUrl ImgUrlAns' id='Answer' type='file' placeholder='Example : sssssssssssssssssssssssssssssssssssssssssssssssssssssssssssss'>" +
                                                                        "<button class='btn btn-danger ms-4 rounded-pill removeRow' data-repeater-delete>" +
                                                                        "<span class='align-middle'><i class='fas fa-backspace'></i></span>" +
                                                                        "</button>" +
                                                                        "<button class='btn btn-secondary ms-2 rounded-pill viewImage' type='button'><i class='far fa-file-image' style='font-size:18px;'></i></button>" +
                                                                        "</div>"
                                                                    );
                                                                    console.log("Radio button name:", radioName);
                                                                    $(this).closest(".card").find(".ans").append(newAns);

                                                                    $(this).data('handled', true);
                                                                });
                                                            </script>

                                                            <div class="mb-3">
                                                                <label for="Question"><strong>Question Body :</strong></label>
                                                                <div class="input-group">
                                                                    <input class="form-control Question" id="Question" type="text" name="Body"
                                                                    placeholder="Example : What is the Measuring unit of Voltage ?" asp-for="@mainQuestion.Body" data-question-id="@mainQuestion.ID">

                                                                    <input class="form-control ms-3 BodyImage" type="file" asp-for="@mainQuestion.ImgUrl" id="BodyImage" data-question-id="@mainQuestion.ID">

                                                                    <button class="btn btn-secondary ms-2 rounded-pill viewImage" type="button" value="@mainQuestion.ImgUrl" data-image-src="@mainQuestion.ImgUrl" data-question-id="@mainQuestion.ID">
                                                                        <i class="far fa-file-image" style="font-size: 18px;"></i>
                                                                    </button>

                                                                   
                                                                </div>
                                                            </div>
                                                            <div class="mb-3">
                                                                <label for="Answer"><strong>Answer Body :</strong></label>
                                                                @{
                                                                    var AnswersText = mainQuestion.Answers.Split(',');
                                                                    var AnswerImages = mainQuestion.AnswersURL == null ? null : mainQuestion.AnswersURL.Split(',');
                                                                    var RadioId = "q" + RadioCounter;                                
                                                                }

                                                                @for (var index = 0; index < AnswersText.Length; index++)
                                                                {
                                                                    @*string? Ans = AnswersText[index];*@
                                                                    string Ans = AnswersText != null ? AnswersText[index] : "";
                                                                    string? ImageSrc = AnswerImages != null ? AnswerImages[index] : null;
                                                                    bool correctImg = mainQuestion.CorrectAnswerUrl == ImageSrc ? true : false;
                                                                    bool correctTxt = mainQuestion.CorrectAnswer == Ans ? true : false;

                                                                    <div class="input-group py-2">
                                                                        <input type="radio" name="@("Radio" + RadioId)" class='me-3 correct-answer' checked="@(correctImg && correctTxt)"/>
                                                                        <input class="form-control answer" id="Answer" type="text" name="" placeholder="Example: Volt" asp-for="@Ans" data-question-id="@mainQuestion.ID">
                                                                        <input class="form-control ms-3" type="file" asp-for="@ImageSrc" id="AnswerImage" data-question-id="@mainQuestion.ID">
                                                                        @if (index == 0)
                                                                        {
                                                                            <button class='btn btn-success rounded-pill ms-4 an' type='button'><i class='fas fa-plus-circle'></i></button>
                                                                        }
                                                                        else
                                                                        {
                                                                            <button class='btn btn-danger ms-4 rounded-pill removeRow' data-repeater-delete>
                                                                                <span class='align-middle'><i class='fas fa-backspace'></i></span>
                                                                            </button>
                                                                        }
                                                                        <button class="btn btn-secondary ms-2 rounded-pill viewImage viewImageAns" value="@ImageSrc" type="button" data-image-src="@ImageSrc" data-question-id="@mainQuestion.ID">
                                                                            <i class="far fa-file-image" style="font-size: 18px;"></i>
                                                                        </button>
                                                                    </div>

                                                                }

                                                                <div class="ans">
                                                                </div>

                                                                @{
                                                                    RadioCounter++;
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            @{
                                                VersionCounter = 0;
                                            }

                                            @foreach (var version in Model.Where(q => q.VersionID == mainQuestion.ID.ToString() && q.ID != mainQuestion.ID))
                                            {
                                                VersionCounter++;
                                                <div class="card card-absolute border border-secondary" id="initialVersions" style="margin-top: 7% !important;">
                                                    <div class="card-header bg-warning rounded-pill" style="top: -26px;">
                                                        <h5 class="text-white">Version : @VersionCounter</h5>
                                                    </div>
                                                    <div class="card-body align-items-center justify-content-center tab">
                                                        <div class="widget-content">
                                                            <div style='text-align: right !important;'>
                                                                <a class='btn btn-danger text-right rounded-pill' asp-action="DeleteVersion" asp-controller="Question" asp-route-id="@version.ID" asp-route-quizId="@version.QuizID"><strong><i class="fas fa-trash-alt"></i></strong></a>
                                                            </div>
                                                            <div class="row">
                                                                <div class="mb-3">
                                                                    <label for="Question"><strong>Question Version Body :</strong></label>
                                                                    <div class="input-group">
                                                                        <input class="form-control Question" id="Question" type="text" name="Body"
                                                                        placeholder="Example : What is the Measuring unit of Voltage ?" asp-for="@version.Body">
                                                                        <input class="form-control ms-3" type="file" asp-for="@version.AnswersURL" id="BodyImage">

                                                                        <button class="btn btn-secondary ms-2 rounded-pill viewImage" type="button" data-image-src="@version.ImgUrl">
                                                                            <i class="far fa-file-image" style="font-size: 18px;"></i>
                                                                        </button>
                                                                    </div>
                                                                </div>
                                                                <div class="mb-3">
                                                                    <label for="Answer"><strong>Answer Body :</strong></label>
                                                                    @{
                                                                        var VersionAnswersText = version.Answers.Split(',');
                                                                        var VersionAnswersAnswerImages = version.AnswersURL.Split(',');
                                                                        var VersionRadioId = "q" + RadioCounter;
                                                                        @for (var index = 0; index < VersionAnswersText.Length; index++)
                                                                        {
                                                                            var Ans = VersionAnswersText[index];
                                                                            var ImageSrc = VersionAnswersAnswerImages[index];
                                                                            <div class="input-group py-1">
                                                                                <input type="radio" name="@("Radio" + VersionRadioId)" class='me-3 correct-answer' checked="@(Ans == version.CorrectAnswer)" />
                                                                                <input class="form-control answer" id="Answer" type="text" name="" placeholder="Example: Volt" asp-for="@Ans">
                                                                                <input class="form-control ms-3" type="file" value="@AnswerImages" asp-for="@Ans" id="AnswerImage">
                                                                                @if (index == 0)
                                                                                {
                                                                                    <button class='btn btn-success rounded-pill ms-4 an' type='button'><i class='fas fa-plus-circle'></i></button>
                                                                                } 
                                                                                else
                                                                                {
                                                                                    <button class='btn btn-danger ms-4 rounded-pill removeRow' data-repeater-delete>
                                                                                        <span class='align-middle'><i class='fas fa-backspace'></i></span>
                                                                                    </button>
                                                                                }
                                                                                <button class="btn btn-secondary ms-2 rounded-pill viewImage" type="button" data-image-src="@ImageSrc">
                                                                                    <i class="far fa-file-image" style="font-size: 18px;"></i>
                                                                                </button>
                                                                            </div>
                                                                        }
                                                                        RadioCounter++;
                                                                    }
                                                                    <div class="ans"></div>
                                                                </div>
                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            }
                                        </div>
                                    </div>
                                    MainQuestionCounter++;
                                }
                            }
                            else
                            {
                                <div class="card mb-5 w-75 mx-auto d-flex justify-content-center align-items-center border border-secondary rounded-pill" id="no-quizzes-placeholder">
                                    <div class="row g-0 text-center">
                                        <h2 class="mb-0"><img width="70" height="70" src="https://img.icons8.com/fluency/70/cancel.png" alt="cancel" /> No published Quizes</h2>
                                    </div>
                                </div>
                            }


                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
</div>

<div class="modal fade" id="imagePreviewModal" tabindex="-1" aria-labelledby="imagePreviewModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
        <div class="modal-content" style="gap: 8px; padding-top: 36px; background-color: transparent; border: none; align-items: flex-end;">
            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            <div id="imgBox" style="max-width: 100%; max-height: 100%;">
                <img class="ImgUrl img-fluid" src="" alt="" id="selectedImagePreview" style="object-fit: contain;">
            </div>
        </div>
    </div>
</div>

<script>

    var EditedQuestions = [];

    $(document).off('blur', '.Question, .BodyImage').on('blur', '.Question, .BodyImage', function () {
        var questionId = $(this).data('question-id');

        var editedQuestion = {
            QuestionId: questionId,
            QuestionBodyValue: $('.Question[data-question-id="' + questionId + '"]').val(),
            BodyImageValue: $('.viewImage[data-question-id="' + questionId + '"]').val(),
            Answers: []
        };

        var answers = $(".answer[data-question-id='" + questionId + "']");
        var imageInputs = $(".viewImageAns[data-question-id='" + questionId + "']");

        answers.each(function (index) {
            var answerTextValue = $(this).val();
            var answerImgValue = $(imageInputs[index]).val();

            editedQuestion.Answers.push({
                AnswerTextValue: answerTextValue,
                AnswerImgValue: answerImgValue
            });
        });



        EditedQuestions.push(editedQuestion);

        console.log(EditedQuestions);
    });

    $(document).on('click', '.viewImage', function () {
        var imageSrc = $(this).data('image-src');
        var inputElement = $(this).closest('.input-group').find('.ImgUrl')[0];

        if (imageSrc) {
            var imageName = imageSrc.split('\\').pop();
            var imageFinalUrl = '@Url.Content("~/uploads/")' + imageName;
            $("#selectedImagePreview").attr("src", imageFinalUrl);
            $("#imagePreviewModal").modal("show");
        } else if (inputElement && inputElement.files && inputElement.files[0]) {
            var reader = new FileReader();
            reader.onload = function (e) {
                $("#selectedImagePreview").attr("src", e.target.result);
                $("#imagePreviewModal").modal("show");
            };
            reader.readAsDataURL(inputElement.files[0]);
        } else {
            Swal.fire({
                icon: "error",
                title: "Oops...",
                text: "You must upload a picture",
            });
        }
    });

    var versionCounter = @VersionCounter + 1, counter = 0;

    var activeTab = $(".tab-content .tab-pane.active");


    $("#versions").on("click", ".removeVersion", function () {
       
        var versionToRemove = $(this).data("version");
        $("#version" + versionToRemove).remove();
        versionCounter--;
    });

    $(".addRow").click(function () {
        counter++;
        var newVersion = $(
            "<div class='col-sm-12 col-xl-12 mt-5 mb-3 tab' id='version" + versionCounter + "'>" +
                "<div class='card card-absolute border border-secondary mt-5'>" +
                    "<div class='card-header bg-warning rounded-pill' style='top: -26px;'>" +
                        "<h5 class='text-white'>New Version</h5>" +
                    "</div>" +
                        "<div class='card-body align-items-center justify-content-center'>" +
                            "<div class='widget-content'>" +
                                "<div class='row'>" +
                                    "<div class='col-lg-12'>" +
                                        "<div style='text-align: right !important;'>" +
                                            "<button class='btn btn-danger text-right rounded-pill removeVersion' data-version='" + versionCounter + "'>Remove</button>" +
                                        "</div>" +
                                    "</div>" +
                                    "<div class='mb-3'>" +
                                        "<label for='Question'><strong>Question Body :</strong></label>" +
                                        "<div class='input-group'>" +
                                            "<input class='form-control Question' id='Question' type='text' name='Body' placeholder='Example : What is the Measuring unit of Voltage ?'>" +
                                            "<input class='form-control ms-3 ImgUrl' id='BodyImage' type='file' name='ImgUrl' placeholder='Example : Volt' id='BodyImage'>" +
                                            "<button class='btn btn-secondary ms-2 rounded-pill viewImage' type='button'><i class='far fa-file-image' style='font-size:18px;'></i></button>" +
                                        "</div>" +
                                    "</div>" +
                                    "<div class='mb-3'>" +
                                        "<label for='Answer'><strong>Answer Body :</strong></label>" +
                                        "<div class='input-group py-3'>" +
                                            "<input type='radio' name='ans" + counter + "' class='me-3 correct-answer' checked />" +
                                            "<input class='form-control answer' id='Answer' type='text' placeholder='Example : Volt'>" +
                                            "<input class='form-control ms-2 ImgUrl ImgUrlAns' id='Answer' type='file' placeholder='Example : Volt'>" +
                                            "<button class='btn btn-success rounded-pill ms-4 an' type='button'><i class='fas fa-plus-circle'></i></button>" +
                                            "<button class='btn btn-secondary ms-2 rounded-pill viewImage' type='button'><i class='far fa-file-image' style='font-size:18px;'></i></button>" +
                                        "</div>" +
                                    "</div>" +
                                    "<div class='mb-3 ans'>" +
                                    "</div>" +
                                "</div>" +
                            "</div>" +
                        "</div>" +
                    "</div>" +
                "</div>" +
            "</div>"
        );

        $(".tab-content .tab-pane.active").append(newVersion);
        versionCounter++;
    });



    $(document).on("click", ".removeRow", function () {
       
        $(this).closest(".input-group").remove();
    });

    $(".an[data-version='main']").click(function () {
        var newAns = $(
            "<div class='d-flex align-items-center justify-content-evenly py-2 input-group'>" +
                "<input type='radio' name='ans0' class='me-3 correct-answer'/>" +
            "<input type='text' class='form-control text-center text-black answer' placeholder='Answer'>" +
                "<input class='form-control ms-3 ImgUrl ImgUrlAns' id='Answer' type='file' placeholder='Example : Volt'>" +
                "<button class='btn btn-danger rounded-pill ms-4 removeRow' data-repeater-delete>" +
                    "<span class='align-middle'><i class='fas fa-backspace'></i></span>" +
                "</button>" +
                "<button class='btn btn-secondary ms-2 rounded-pill viewImage' type='button'><i class='far fa-file-image' style='font-size:18px;'></i></button>" +
            "</div>"
        );

        $(".tab-content").find(".tab-pane.active").find(".ans-main").append(newAns);
    });

    $(document).on("click", ".removeRow", function () {
        $(this).closest(".d-flex").remove();
    });


   

    $("#question-tabs-content").on("click", ".removeVersion", function () {
        var versionToRemove = $(this).data("version");
        $("#version" + versionToRemove).remove();
        versionCounter--;
    });

    var QuizId = @Html.Raw(Json.Serialize(Model.FirstOrDefault().QuizID));




    $(document).on("click", ".removeMainQuestion", function () {



        Swal.fire({
            title: "Are you sure?",
            text: "You won't be able to revert this!",
            icon: "warning",
            showCancelButton: true,
            confirmButtonColor: "#3085d6",
            cancelButtonColor: "#d33",
            confirmButtonText: "Yes, delete it!"
        }).then((result) => {
            if (result.isConfirmed) {
                var questionIdToRemove = $(this).data("question-id");
                console.log("QuestionId: " + questionIdToRemove);
                console.log("QuizId: " + QuizId);

                $.ajax({
                    url: '/Question/DeleteQuestion',
                    type: 'POST',
                    contentType: 'application/json',
                    data: JSON.stringify({ id: questionIdToRemove, quizId: QuizId }),
                    success: function (response) {
                        console.log('AJAX success:', response);
                        location.reload();
                    },
                    error: function (xhr, status, error) {
                        console.error('Error sending data to server:', error);
                    }
                });


            }
        });

    });

    $("#submit").click(function (e) {
        e.preventDefault();

        const swal = Swal.mixin({
            customClass: {
                confirmButton: "btn btn-success mx-2 rounded-pill",
                cancelButton: "btn btn-danger rounded-pill"
            },
            buttonsStyling: false
        });

        swal.fire({
            title: "Successfully Added !",
            text: "Do you want to add another question ?",
            icon: "success",
            showCancelButton: true,

        }).then((result) => {
            if (result.isConfirmed) {

                var questionsJson = [];
                var formData = new FormData();
                var tabNumber = 0;
                $(".tab").each(function () {
                    var fileInput = $(this).find("#BodyImage")[0];
                    var file = fileInput.files[0];
                    formData.append('bodyImage_' + tabNumber, file);

                    var j = 0;
                    $(this).find('.ImgUrlAns').each(function () {
                        var answerFileInput = $(this)[0];
                        var answerFiles = answerFileInput.files[0];
                        formData.set('answerImages_' + tabNumber + "_" + j, answerFiles);
                        j++;
                    });

                    var correctAnswerIndex = -1;
                    var radioButtons = $(this).find('input[type="radio"]');
                    var radioButtonArray = Array.from(radioButtons);
                    for (var i = 0; i < radioButtonArray.length; i++) {
                        if (radioButtonArray[i].checked == true) {
                            correctAnswerIndex = i;
                            break;
                        }
                    }

                    var questionData = {
                        Body: $(this).find(".Question").val(),
                        Answers: [],
                        CorrectAnswer: "",
                        CorrectAnswerIndex: correctAnswerIndex,
                        QuizID: QuizId.toString(),
                        VersionID: ""
                    };

                    $(this).find(".answer").each(function () {
                        questionData.Answers.push($(this).val());
                    });

                    questionData.CorrectAnswer = $(this).find('.correct-answer:checked').closest('.input-group').find('.answer').val();
                    questionData.VersionID = $("#VersionID").val();
                    questionsJson.push(questionData);
                    tabNumber++;


                });

                //for (let pair of formData) {
                //    console.log(pair[0] + ', ' + pair[1]);
                //}


                //console.log(questionsJson);




                //$.ajax({
                //    url: '/Question/UploadFiles',
                //    type: 'POST',
                //    data: formData,
                //    contentType: false,
                //    processData: false,
                //    success: function (fileResponse) {
                //        $.ajax({
                //            url: '/Question/Create',
                //            type: 'POST',
                //            contentType: 'application/json',
                //            data: JSON.stringify({ questions: questionsJson, filePaths: fileResponse }),
                //            success: function (response) {
                //                location.reload();
                //            },
                //            error: function (xhr, status, error) {
                //                console.error('Error sending data to server:', error);
                //            }
                //        });
                //    },
                //    error: function (xhr, status, error) {
                //        console.error('Error uploading files:', error);
                //    }
                //});

            } else if (result.isDenied) {
                swal.fire({
                    title: "Do you want to add Questions or not ?",
                    showCancelButton: true,
                    confirmButtonText: "Yes, add Questions!",
                    denyButtonText: `No, don't add Questions!`,
                    icon: "question"
                }).then((result) => {
                    if (result.isConfirmed) {
                        var questionsJson = [];
                        var formData = new FormData();
                        var tabNumber = 0;
                        $(".tab").each(function () {
                            var fileInput = $(this).find("#BodyImage")[0];
                            var file = fileInput.files[0];
                            formData.append('bodyImage_' + tabNumber, file);

                            var j = 0;
                            $(this).find('.ImgUrlAns').each(function () {
                                var answerFileInput = $(this)[0];
                                var answerFiles = answerFileInput.files[0];
                                formData.set('answerImages_' + tabNumber + "_" + j, answerFiles);
                                j++;
                            });

                            var correctAnswerIndex = -1;
                            var radioButtons = $(this).find('input[type="radio"]');
                            var radioButtonArray = Array.from(radioButtons);
                            for (var i = 0; i < radioButtonArray.length; i++) {
                                if (radioButtonArray[i].checked == true) {
                                    correctAnswerIndex = i;
                                    break;
                                }
                            }

                            var questionData = {
                                Body: $(this).find(".Question").val(),
                                Answers: [],
                                CorrectAnswer: "",
                                CorrectAnswerIndex: correctAnswerIndex,
                                QuizID: QuizId.toString(),
                                VersionID: ""
                            };

                            $(this).find(".answer").each(function () {
                                questionData.Answers.push($(this).val());
                            });

                            questionData.CorrectAnswer = $(this).find('.correct-answer:checked').closest('.input-group').find('.answer').val();
                            questionData.VersionID = $("#VersionID").val();
                            questionsJson.push(questionData);
                            tabNumber++;
                        });

                        console.log(questionsJson);

                        //$.ajax({
                        //    url: '/Question/UploadFiles',
                        //    type: 'POST',
                        //    data: formData,
                        //    contentType: false,
                        //    processData: false,
                        //    success: function (fileResponse) {
                        //        $.ajax({
                        //            url: '/Question/Create',
                        //            type: 'POST',
                        //            contentType: 'application/json',
                        //            data: JSON.stringify({ questions: questionsJson, filePaths: fileResponse }),
                        //            success: function (response) {
                        //                location.reload();
                        //            },
                        //            error: function (xhr, status, error) {
                        //                console.error('Error sending data to server:', error);
                        //            }
                        //        });
                        //    },
                        //    error: function (xhr, status, error) {
                        //        console.error('Error uploading files:', error);
                        //    }
                        //});

                    } else if (result.isDenied) {
                        location.reload();
                    }
                });
            }
        });
    });




    $(document).ready(function () {
        // Assuming each Question input has a unique ID based on mainQuestion.ID
        $("#Question-mainQuestion.ID").on("input", function () {
            alert();
            // This function will be called when the input changes
            var changedValue = $(this).val();
            console.log("Question Body changed to: " + changedValue);

            // Perform any action you want with the changed value
        });
    });






</script>
